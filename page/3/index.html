<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/zztttt.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/zztttt.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/zztttt.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/zztttt.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/zztttt.github.io/css/main.css">


<link rel="stylesheet" href="/zztttt.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/zztttt.github.io/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="SE@SJTU">
<meta property="og:type" content="website">
<meta property="og:title" content="zztttt">
<meta property="og:url" content="http://github.com/page/3/index.html">
<meta property="og:site_name" content="zztttt">
<meta property="og:description" content="SE@SJTU">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zztttt">
<meta name="twitter:description" content="SE@SJTU">

<link rel="canonical" href="http://github.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>zztttt</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/zztttt.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">zztttt</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/zztttt.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/zztttt.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2020/07/03/database/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2020/07/03/database/" class="post-title-link" itemprop="url">database</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-03 13:08:58" itemprop="dateCreated datePublished" datetime="2020-07-03T13:08:58+08:00">2020-07-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/zztttt/" itemprop="url" rel="index"><span itemprop="name">zztttt</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h2><p>是由一系列对系统中数据进行访问与更新的操作所组成的一个<strong>程序执行逻辑单元</strong>（Unit)。<br><strong>狭义上</strong>的事务特指数据库事务。一方面，当多个应用程序<strong>并发访问</strong>数据库时，事务可以在这些应用程序之间提供一个<strong>隔离方法</strong>，以防止彼此的操作互相干扰。另一方面，事务为数据库操作序列提供了一个从失败中恢复到正常状态的方法， 同时提供了数据库即使在异常状态下仍能保持数据一致性的方法  </p>
<ul>
<li>ACID:<ul>
<li>Automicity：原子性，强调事务作为原子级别已经不可以再被分割，要么成功要么失败</li>
<li>Consistency：一致性，即状态转换必须是由一种正确的状态转换到另外一种正确的状态</li>
<li>Isolation：隔离性，即相互间必须不能被影响，处理并发的问题</li>
<li>Durabillity：持久性，即事务提交后将被永久保存，即便出现其他故障，事务处理结果也应得到保存。</li>
<li>若不考虑Isolation则会有三个问题：？？下面哪一个不是啊？？<ul>
<li>脏读：B事务读取到了A事务尚未提交的数据（没提交可能会回滚，导致读到了错误的数据）</li>
<li>不可重复读：一个事务中两次读取的数据的内容不一致（在这两次中别的事务修改了数据）</li>
<li>幻读：一个事务中两次读取的数据的数量不一致（）</li>
<li>丢失修改：多个并发事务修改，前面的被后面的覆盖掉  </li>
</ul>
</li>
<li>隔离级别分为三个：<ul>
<li>read uncommitted：哪个都不能解决。对读的数据不加锁</li>
<li>read commited：解决脏读，oracle默认。对读的数据加<strong>行级共享锁</strong></li>
<li>repeatable read：可重复读，解决脏读和不可重复读，mysql默认。读加共享锁，写加排它锁</li>
<li>serializable：相当于锁表，能解决三个问题。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="MySQL语法"><a href="#MySQL语法" class="headerlink" title="MySQL语法"></a>MySQL语法</h2><ul>
<li>查询最新的10条数据。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from table order by id desc limit 10</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><ul>
<li>索引是什么？<br>索引就像书的目录。了解一下平衡树</li>
<li>没加主键之前，数据都是很整齐的顺序排列，加了主键之后，就成树状了，可以说整个表成了一个索引，这就是聚集索引</li>
<li>聚簇索引和非聚簇索引</li>
</ul>
<table>
<thead>
<tr>
<th>聚簇索引</th>
<th>非聚簇索引</th>
</tr>
</thead>
<tbody>
<tr>
<td>多行检测快</td>
<td>单行检测快</td>
</tr>
<tr>
<td>按照数据存分的物理位置为顺序的</td>
<td>不是</td>
</tr>
<tr>
<td>叶子节点即为数据块</td>
<td>叶子节点还是索引</td>
</tr>
</tbody>
</table>
<ul>
<li>索引不是越多越好？<br>大多数情况下索引能大幅度提高查询效率，但是！数据的变更（增删改）都需要维护索引，因此越多意味着<strong>维护成本越高</strong>，意味着需要<strong>更多的空间</strong><br>比较小的表可能建立索引后更慢</li>
<li>什么时候不适合建立索引？<ul>
<li>表太小</li>
<li>经常插入、删除、修改的表</li>
<li>数值重复且分布均匀 ？为什么</li>
</ul>
</li>
<li>索引为什么快？<br>如果你采用合适的算法遍历整个树，可以得到一个<strong>有序的列表</strong>。这也是为什么如果有数据库索引的情况下，你order by你索引的值，就会速度特别快，因为它并没有给你真的排序，只是<strong>遍历树</strong>而已。</li>
</ul>
<h2 id="范式"><a href="#范式" class="headerlink" title="范式"></a>范式</h2><ul>
<li>三大范式：<ul>
<li>每列保持原子性</li>
<li>每列都与主键相关</li>
<li>每列都与主键直接相关而不是间接相关</li>
<li>…</li>
</ul>
</li>
</ul>
<h2 id="多表连接"><a href="#多表连接" class="headerlink" title="多表连接"></a>多表连接</h2><ul>
<li>自然连接：要求属性值相同的行，并消除重复属性列</li>
<li>内连接：保证两个表分所有行都要满足连接条件，不过不要求属性值相同</li>
<li>外连接：<ul>
<li>左外连接：以左边为准，右边没有的填null</li>
<li>右外连接：以右边为准，左边没有的填null</li>
</ul>
</li>
</ul>
<h2 id="数据库的锁"><a href="#数据库的锁" class="headerlink" title="数据库的锁"></a>数据库的锁</h2><ul>
<li>共享锁<br>允许多个线程访问同一资源，例如读写锁<strong>read</strong>状态</li>
<li>互斥锁<br>在访问资源之前加锁，访问完成之后解锁。其他任何试图再次加锁的都会被阻塞，直到当前进程解锁。例如读写锁<strong>write</strong>状态</li>
</ul>
<h2 id="数据库的备份与恢复"><a href="#数据库的备份与恢复" class="headerlink" title="数据库的备份与恢复"></a>数据库的备份与恢复</h2><p>备份：将源数据再次存储到新的位置。三种常见的：完全备份、增量备份、差异备份。  </p>
<ul>
<li>备份的内容：<ul>
<li>数据</li>
<li>二进制日志</li>
<li>InnoDB存储以前的事务日志文件</li>
<li>代码——存储过程，存储函数，触发器，事件调度器等</li>
<li>当前服务器上用于启动数据服务是所使用的配置文件</li>
<li>操作系统上与MySQL或MariaDB相关的配置——sudo任务、cron任务等</li>
</ul>
</li>
<li>恢复：<br>将备份好的数据重新应用到数据库系统</li>
</ul>
<h2 id="大规模数据库设计"><a href="#大规模数据库设计" class="headerlink" title="大规模数据库设计"></a>大规模数据库设计</h2><ul>
<li>把经常用的和不经常用的分开几个表，<strong>横向切分</strong></li>
<li>不同类型的分成几个表，<strong>纵向切分</strong></li>
<li>服务器放几个硬盘，把数据、日志、索引分盘存放，提高I/O吞吐率</li>
<li>建立统计表（cache），避免每次查询都统计一次</li>
<li>注意负载均衡</li>
</ul>
<h2 id="一个每秒百万级访问量的互联网服务器，每个访问都有数据计算和I-O操作，如果让你设计，你怎么设计？"><a href="#一个每秒百万级访问量的互联网服务器，每个访问都有数据计算和I-O操作，如果让你设计，你怎么设计？" class="headerlink" title="一个每秒百万级访问量的互联网服务器，每个访问都有数据计算和I/O操作，如果让你设计，你怎么设计？"></a>一个每秒百万级访问量的互联网服务器，每个访问都有数据计算和I/O操作，如果让你设计，你怎么设计？</h2><ul>
<li>设计成分布式的，将这些请求分给多台服务器去处理，每台都有着相同的数据、日志</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2020/07/01/Java-Collection/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2020/07/01/Java-Collection/" class="post-title-link" itemprop="url">Java: Collection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-01 18:45:50" itemprop="dateCreated datePublished" datetime="2020-07-01T18:45:50+08:00">2020-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/zztttt/" itemprop="url" rel="index"><span itemprop="name">zztttt</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Hashmap"><a href="#Hashmap" class="headerlink" title="Hashmap"></a>Hashmap</h2><p>底层是数组+链表/红黑树实现的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//成员变量</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table; <span class="comment">//底层数据结构，用于存储添加到HashMap中的Key-value对</span></span><br><span class="line"><span class="keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet; <span class="comment">//返回Node实体</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size; <span class="comment">//Map中的key-value对的数量</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line"><span class="keyword">int</span> threshold;<span class="comment">//临界值,当超过临界值时，HashMap就该扩容</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> loadFactor;<span class="comment">//装载因子,衡量HashMap满的程度，默认值为DEFAULT_LOAD_FACTOR=0.75f</span></span><br></pre></td></tr></table></figure></p>
<p>Node是一个static内部类。多个Node以链表的形式连接起来，然后在Hashmap内用数组来保留这些链表的起点，结合了这两种数据结构，保留了各自的优点，又弥补了各自的缺点。<br><strong>但是是JDK8中，如果链表长度太长就会转化为红黑树。</strong></p>
<ul>
<li>Node&lt;K,V&gt;[] table<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Node&lt;K,V&gt; next;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>因此Hashmap的结构如下所示。<br><img src="https://zztttt.github.io/picture/java-collection/hashmap.png" alt="hashmap">  </p>
<ul>
<li><p>Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet<br>entrySet变量为EntrySet实体，Map.Entry&lt;K,V&gt;是一个接口，Node类就实现了该接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">    Set&lt;Map.Entry&lt;K,V&gt;&gt; es;</span><br><span class="line">    <span class="keyword">return</span> (es = entrySet) == <span class="keyword">null</span> ? (entrySet = <span class="keyword">new</span> EntrySet()) : es;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>扩容机制<br>容量的规则为2的幂次，即capacity可以是1，2，4，8，16，32…<br>根据传进来的容量来找最近的2的幂次</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = capacity - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h2><p>是java中Set接口的一个实现类，底层是用Hashmap实现的，而Hashmap是数组+链表/红黑树实现的。如果链表长度大于8，就转化为红黑树，如果容量不够，则需扩容。<br><img src="https://zztttt.github.io/picture/java-collection/hashset.png" alt="hashset">  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>常用方法：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化一个空的set</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span></span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传入的集合添加到新的set</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span></span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(Math.max((<span class="keyword">int</span>) (c.size()/.<span class="number">75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//明确初始容量和装载因子</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span></span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//明确容量</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span></span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// add， value值是被写死的</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object PRESENT = <span class="keyword">new</span> Object();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// remove，调用map的remove</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.remove(o)==PRESENT;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line">Iterator it = set.iterator();</span><br><span class="line"><span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">    System.out.println(it.next());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h2><p>是HashSet的派生类。源码没什么实质性的东西，都是对HashSet的一个继承。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt; </span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(initialCapacity, loadFactor, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(initialCapacity, .<span class="number">75f</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="number">16</span>, .<span class="number">75f</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(Math.max(<span class="number">2</span>*c.size(), <span class="number">11</span>), .<span class="number">75f</span>, <span class="keyword">true</span>);</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Spliterator&lt;E&gt; <span class="title">spliterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Spliterators.spliterator(<span class="keyword">this</span>, Spliterator.DISTINCT | Spliterator.ORDERED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h2><p>完全依赖于TreeMap来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">NavigableSet</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">TreeSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">new</span> TreeMap&lt;E,Object&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TreeSet</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; comparator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">new</span> TreeMap&lt;&gt;(comparator));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TreeSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>();</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TreeSet</span><span class="params">(SortedSet&lt;E&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(s.comparator());</span><br><span class="line">        addAll(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.cnblogs.com/LiaHon/p/11142958.html" target="_blank" rel="noopener">HashMap原理(一) 概念和底层架构</a><br><a href="https://www.cnblogs.com/LiaHon/p/11257805.html" target="_blank" rel="noopener">Java集合 HashSet的原理及常用方法</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2020/07/01/computer-network/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2020/07/01/computer-network/" class="post-title-link" itemprop="url">computer network</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-01 13:21:46" itemprop="dateCreated datePublished" datetime="2020-07-01T13:21:46+08:00">2020-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/zztttt/" itemprop="url" rel="index"><span itemprop="name">zztttt</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h2><p>应用-运输（表示+会话+传输)-网络-链路-物理<br><img src="https://zztttt.github.io/picture/computer-network/OSI.png" alt="OSI">  </p>
<table>
<thead>
<tr>
<th>层级</th>
<th>作用</th>
<th>样例</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用层</td>
<td>为网络应用提供访问OSI环境手段</td>
<td>FTP</td>
</tr>
<tr>
<td>表示层</td>
<td>处理两个通信系统中交换信息的表示方式</td>
<td></td>
</tr>
<tr>
<td>会话层</td>
<td>两个节点之间建立端连接。具体管理两个用户和进程之间的对话</td>
<td></td>
</tr>
<tr>
<td>传输层</td>
<td>常规数据递送-面向无连接或有连接</td>
<td>TCP/UDP。这里叫<strong>segment</strong></td>
</tr>
<tr>
<td>网络层</td>
<td>通过寻址来建立两个节点之间的连接</td>
<td>IP。这里叫<strong>packet</strong></td>
</tr>
<tr>
<td>数据链路层</td>
<td>将数据分帧，并处理流控制</td>
<td>网卡、交换机。这里叫<strong>frame</strong></td>
</tr>
<tr>
<td>物理层</td>
<td>利用物理传输介质来为第二层提供物理连接</td>
<td>网线。比特流</td>
</tr>
</tbody>
</table>
<p>在传输层tcp+data，传给网络层，封装为ip+data，传给链路层，以太hdr+data+以太ftr，封装结束。<br>封装结束后通过总线到达主机接口，再通过网线被送到主机A的接口，然后把报头层层去掉，给应用层</p>
<ul>
<li>ARP：完成了MAC与IP地址的映射。发送到dst时，若ARP里面有IP对应的MAC，就直接发；<br>没有就ARP请求获得MAC</li>
</ul>
<h2 id="TCP（Transmission-Control-Protocol）"><a href="#TCP（Transmission-Control-Protocol）" class="headerlink" title="TCP（Transmission Control Protocol）"></a>TCP（Transmission Control Protocol）</h2><ul>
<li>如何保证正确性？<ul>
<li>数据别校验：checksum。若出错就丢弃报文，然后发送端超时重发</li>
<li>对乱序数据包重排序：顺序后才交给应用层</li>
<li>丢弃重复数据</li>
<li>应答机制：ack。发送一个确认</li>
<li>超时重发</li>
<li>流量控制：每一方都有固定大小的缓存空间，接收端只允许另一端发送接收端缓冲区所能接纳的数据，可以防止较快主机致使较慢的缓冲区溢出。通过sliding window</li>
</ul>
</li>
<li>三次握手<br><img src="https://zztttt.github.io/picture/computer-network/三次握手.png" alt="三次握手"><ul>
<li>我要和你连接；你真的要和我连接吗？；我真的要！</li>
<li>原因：<br>为了防止已失效的链接请求报文突然又传送到了服务端产生错误。简单来说就是某一次client的请求延迟到了，事实上client已经不想连接了，但是server以为要连，然后建立连接，这时client忽略了server的请求，但是server一直在等client发送data，就浪费了资源</li>
</ul>
</li>
<li>四次挥手<br><img src="https://zztttt.github.io/picture/computer-network/四次挥手.png" alt="四次挥手"><ul>
<li>我要和你断开；好的断吧；我也要和你断开好的，断吧</li>
<li>最后一个ACK的作用：<br>在主动发起close的一方，发送最后一个ACK后会进入time_wait状态（应该说在保持2MSL（Maximum Segment Lifetime）恢复。<br>有可以<strong>最后一个ACK丢失</strong>。所以TIME_WAIT状态就是用来<strong>重发可能丢失的ACK报文</strong>。在Client发送出最后的ACK回复，但该ACK可能丢失。Server如果没有收到ACK，将不断重复发送FIN片段。所以Client不能立即关闭，它必须确认Server接收到了该ACK。</li>
</ul>
</li>
<li>如何避免占用资源<br>改变服务器SO_REUSEADDR套接字选项来通知内核来让time_wait状态下端口仍然能重用</li>
<li>tcp头有多少字节？哪些字段？<br><img src="https://zztttt.github.io/picture/computer-network/tcp.png" alt="tcp"><br>4位头部长度：标识tcp头部有多少字节<br>6位保留（flag）：ACK确认号是否有效、RST是否要对方重新连接、SYN表示请求一个连接、FIN通知关闭。<br>16位窗口大小：告诉tcp缓冲区还能容纳多少字节<br>16位校验和：有发送端填充，接收端对报文执行CRC判断tcp是否损坏<br>tcp选项：窗口扩大因子(TCP Window Scale Option)来增加TCP接收窗口的大小而超过65536字节</li>
<li>connect操作会阻塞，怎么办？<br>设置connect非阻塞，立即返回值。然后把sockfd加入select读写监听集合，通过select判断sockfd是否可写。即让select来等待连接完成，同时给select设置一个时间限制</li>
<li>长连接和短连接的区别<ul>
<li>长连接：在一个TCP上可以连续发送多个数据包；若无数据包（心跳），则需要发送检测包以维持连接多用于<strong>频繁的读写</strong>，而且<strong>连接数不能太多</strong>的情况</li>
<li>短连接：通信双方有数据交互时，就建立一个TCP连接，数据发送<strong>完成后立即断开</strong>此连接。web网站的一般都是短连接，因为用户基数大，如果每个用户都长连接的话消耗资源</li>
</ul>
</li>
</ul>
<h2 id="UDP（User-Datagram-Protocol）"><a href="#UDP（User-Datagram-Protocol）" class="headerlink" title="UDP（User Datagram Protocol）"></a>UDP（User Datagram Protocol）</h2><ul>
<li>udp调用connect有什么用<br>与tcp的connect不一样，tcp会触发三次握手，而udp仅仅是把ip&amp;port给记录下来。<br>tcp只调用一次，udp可以调用多次，作用：1.记录新的ip&amp;port2.断开之前的</li>
</ul>
<h2 id="TCP与UDP对比"><a href="#TCP与UDP对比" class="headerlink" title="TCP与UDP对比"></a>TCP与UDP对比</h2><table>
<thead>
<tr>
<th>类型</th>
<th>TCP</th>
<th>UDP</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否连接</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>传输可靠性</td>
<td>可靠</td>
<td>不可靠</td>
</tr>
<tr>
<td>应用场合</td>
<td>传输大量数据</td>
<td>少量数据</td>
</tr>
<tr>
<td>速度</td>
<td>慢</td>
<td>快</td>
</tr>
<tr>
<td>正确性</td>
<td>保证</td>
<td>丢包</td>
</tr>
<tr>
<td>复杂性</td>
<td>复杂</td>
<td>简单</td>
</tr>
<tr>
<td>应用场景</td>
<td>qq文件</td>
<td>qq语音视频</td>
</tr>
<tr>
<td>安全性</td>
<td>容易被攻击</td>
<td>不容易被攻击</td>
</tr>
</tbody>
</table>
<h2 id="拥塞控制机制"><a href="#拥塞控制机制" class="headerlink" title="拥塞控制机制"></a>拥塞控制机制</h2><ul>
<li>网络拥塞：对网络中某一资源的需求<strong>超过了该资源所能提供的</strong>可用部分，网络性能就要<strong>变坏</strong>，这种情况就叫做网络拥塞</li>
<li><p>四种解决方案：<br>发送方：维护拥塞窗口cwnd的状态变量。取决于拥塞程度。将拥塞窗口作为发送窗口，即swnd=cwnd。维护一个慢开始门限ssthresh状态变量。cwnd &lt; ssthresh慢开始，否则拥塞避免。</p>
<ul>
<li><p>慢开始（指数增长）<br>发送方当前只能发送一个数据报文段（拥塞窗口cwnd的值是几，就能发送几个数据报文段），接收方收到该数据报文段后，给发送方回复一个确认报文段，发送方收到该确认报文后，将拥塞窗口的值变为2；后续就是2、4、8.。。之后改用<strong>拥塞避免</strong>算法</p>
</li>
<li><p>拥塞避免<br>每个传输轮次，拥塞窗口cwnd只能线性加一，而不是像慢开始算法时，每个传输轮次，拥塞窗口cwnd按指数增长。<br>假设24个报文段在传输过程中丢失4个，接收方只收到20个报文段，给发送方依次回复20个确认报文段，一段时间后，丢失的4个报文段的重传计时器超时了，发送发判断可能出现拥塞，更改cwnd和ssthresh.并<strong>重新开始</strong>慢开始算法。（发生超时重传）<br><img src="https://zztttt.github.io/picture/computer-network/拥塞避免1.png" alt="1"></p>
</li>
<li><p>快重传<br>发送方发送1号数据报文段，接收方收到1号报文段后给发送方发回对1号报文段的确认，在1号报文段到达发送方之前，发送方还可以将发送窗口内的2号数据报文段发送出去。<br>就是使发送方<strong>尽快进行重传</strong>，而<strong>不是等超时重传计时器超时</strong>再重传。<br>接收方在收到了失序的报文段也要<strong>立即发出</strong>对已收到的报文段的重复确认<br>发送方一旦接受到了三个连续的重复确认，就将相应的报文立即重传，而不是等该报文段的超时重传计时器。此时开始执行快恢复算法</p>
</li>
<li><p>快恢复<br>ssthresh和cwnd调为原来的一半，再执行拥塞避免算法<br><img src="https://zztttt.github.io/picture/computer-network/拥塞避免2.png" alt="2">  </p>
</li>
</ul>
</li>
</ul>
<p>第一二个方法的缺点：个别报文段意外丢失，但是没有阻塞，误认为发生拥塞，cwnd再次设为1，降低传输效率</p>
<h2 id="Http与Https"><a href="#Http与Https" class="headerlink" title="Http与Https"></a>Http与Https</h2><p>http协议运行在tcp之上，明文传输，客户端/服务器无法验证对方身份。https是身披ssl的，添加了加密和认证机制的http。https开销大。</p>
<ul>
<li>http请求方式：<ul>
<li>option：返回服务器对特定资源所支持的HTTP请求方法</li>
<li>head：向服务器索要与GET请求相一致的响应，只不过这响应不会返回</li>
<li>get：向特定资源发送请求</li>
<li>post：向特定资源提交数据进行处理请求，数据被包含在请求体中。可能会导致新的资源的创建或已有资源的修改</li>
<li>put：向指定资源上传其最新内容</li>
<li>delete：请求服务器删除request-URL所标识的资源</li>
<li>trace：回显服务器收到的请求，主要用于测试或判断</li>
<li>connect：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器</li>
</ul>
</li>
<li>get和post区别：<br>get是获取资源，post是更新资源。get的请求url后面会有?带的参数，post会把数据放置在http请求的请求体中</li>
</ul>
<h2 id="网络安全"><a href="#网络安全" class="headerlink" title="网络安全"></a>网络安全</h2><ul>
<li>DDos攻击：是什么？<br>没有根治的方法，除非不使用tcp</li>
</ul>
<h2 id="Session与Cookie"><a href="#Session与Cookie" class="headerlink" title="Session与Cookie"></a>Session与Cookie</h2><table>
<thead>
<tr>
<th>类型</th>
<th>session</th>
<th>cookie</th>
</tr>
</thead>
<tbody>
<tr>
<td>实现机制</td>
<td>依赖于cookie</td>
<td></td>
</tr>
<tr>
<td>大小限制</td>
<td>无</td>
<td>有</td>
</tr>
<tr>
<td>安全性</td>
<td>在服务器端，安全</td>
<td>本地有可能被攻击</td>
</tr>
<tr>
<td>服务器资源消耗</td>
<td>在服务器上保留一段时间消失</td>
<td>过多会增加服务器压力</td>
</tr>
</tbody>
</table>
<h2 id="select和epoll"><a href="#select和epoll" class="headerlink" title="select和epoll"></a>select和epoll</h2><table>
<thead>
<tr>
<th></th>
<th>select</th>
<th>epoll</th>
</tr>
</thead>
<tbody>
<tr>
<td>时间</td>
<td>毫秒</td>
<td>微秒</td>
</tr>
<tr>
<td>unix</td>
<td>支持</td>
<td>有些不支持</td>
</tr>
<tr>
<td>fd限制</td>
<td>有最大fd设置</td>
<td>没有</td>
</tr>
</tbody>
</table>
<ul>
<li>为什么select比epoll慢？<ul>
<li>select可以监听文件描述符是有限的，epoll可监听的文件描述符的个数为进程可打开的文件的个数。</li>
<li>select中，当有事件就绪时，内核修改参数以通知用户，用户需要<strong>遍历所有的fd</strong>判断是哪个fd就绪，应用程序索引就绪文件描述符的时间复杂度是<strong>O(n)</strong>，IO效率随着监听的fd的数目增加而线性下降。<br>而epoll中<strong>注册了回调函数</strong>，当有就绪事件发生的时候，设备驱动程序调用回调函数，将就绪的fd添加到rdllist中，调用epoll_wait时，将rdllist上就绪的fd发送给用户，应用程序索引就绪文件描述符的时间复杂度是<strong>O(1)</strong>，IO效率与fd的数目无关。<br>epoll支持ET模式，当内核将该事件通知给用户后，用户必须立即处理，这样就减少了可读、可写、异常事件被触发的次数。<br>select只能工作在相对较低效的LT模式</li>
</ul>
</li>
<li>epoll有哪些触发模式？<br>水平与边缘</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2020/06/30/operating-system/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2020/06/30/operating-system/" class="post-title-link" itemprop="url">operating system</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-30 13:49:25" itemprop="dateCreated datePublished" datetime="2020-06-30T13:49:25+08:00">2020-06-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/zztttt/" itemprop="url" rel="index"><span itemprop="name">zztttt</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="进程（process）"><a href="#进程（process）" class="headerlink" title="进程（process）"></a>进程（process）</h2><ul>
<li>进程空间分布：<br>一个进程内存分为五个segment，从高到低分别为（stack、heap、bss、data、text）segment</li>
<li>进程通信方式:  <ul>
<li>管道：父子与兄弟进程之间的通信，不是文件系统，存在于内存</li>
<li>FIFO：与进程类型无关的通信方式，以特殊的文件形式存在于文件系统中</li>
<li>消息队列：消息的链列表</li>
<li>信号量： 信号量+共享内存通常结合在一起使用，信号量用来同步对共享内存的访问。<br>即bitmap，与IPC结构不同，它是一个计数器，用于进程间的互斥与同步，需要结合共享内存。<br>它基于operating system的PV操作，对信号量的操作都是原子操作，并且支持信号量组</li>
<li>共享内存：<br>指两个或多个进程共享一个给定的存储区。<br>共享内存是最快的一种 IPC，因为进程是直接对内存进行存取。因为多个进程可以同时操作，所以需要进行同步。解除映射时才写回文件。<br><strong>优点</strong>：效率高。<strong>缺点</strong>：没有同步机制，需要信号量</li>
</ul>
</li>
<li>进程资源的分配方式：<br>由<strong>PCB</strong>(process control block)管理，在32bit系统下，会分配4G内存，3G给用户，1G给内核。<br>内核态有一个task_struct，里面保存以下这些信息：  </li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>标识</td>
<td>pid ppid</td>
</tr>
<tr>
<td>file</td>
<td>打开的文件信息，file descriptor</td>
</tr>
<tr>
<td>memory</td>
<td>内存指针，指向虚拟地址空间的信息</td>
</tr>
<tr>
<td>context</td>
<td>寄存器的值、进程状态、堆栈的内容</td>
</tr>
<tr>
<td>signal</td>
<td>是否还有待处理的信号</td>
</tr>
<tr>
<td>I/O</td>
<td>记录进程和各种I/O设备的交互</td>
</tr>
</tbody>
</table>
<ul>
<li>生命周期：<ul>
<li>僵尸态： 子进程退出后，所有资源都消失了，只剩下 task_struct，父进程在 wait 函数中可以得到子进程的死亡原因。在 wait 之前子进程的状态就是僵尸态。</li>
<li>深度睡眠： 等待资源到位后才醒过来</li>
<li>浅度睡眠： 等待资源到位或收到信号后都会醒过来</li>
<li>暂停： stop状态是被外部命令作业控制等强制进程进入的状态。</li>
<li>就绪： 未占有 CPU，等待调度算法调度到运行态的进程</li>
<li>运行：占有 CPU，正在运行的线程。</li>
</ul>
</li>
<li>进程调度算法<ul>
<li>FIFO</li>
<li>SJF</li>
<li>优先权</li>
<li>轮转时间片</li>
<li>多层队列：Linux默认调度算法</li>
</ul>
</li>
<li>守护进程（daemon）：<br>是一类在后台运行的特殊进程，用于执行特定的系统任务。很多守护进程在系统引导的时候启动，并且一直运行直到系统关闭。另一些只在需要的时候才启动，完成任务后就自动结束。</li>
</ul>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><ul>
<li><p>线程的使用：</p>
<ul>
<li><p>C++-Linux：<br>pthread_join: 需要父线程调用，等待子线程执行完，回收资源。不然资源没法回收<br>pthread_detach: 在该线程运行结束后会<strong>自动释放</strong>所有资源。<br>pthread_cond_t: 必须在<strong>互斥锁</strong>的保护下使用相应的条件变量<br>阻塞在条件变量</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pthread_mutex_lock(<span class="keyword">pthread_mutex_t</span> *mutex);</span><br><span class="line"><span class="keyword">while</span>(condition_is_false)&#123;</span><br><span class="line">    pthread_cond_wait(<span class="keyword">pthread_cond_t</span> *cv, <span class="keyword">pthread_mutex_t</span> *mutex);</span><br><span class="line">&#125;</span><br><span class="line">pthread_mutex_unlock(<span class="keyword">pthread_mutex_t</span> *mutex);</span><br></pre></td></tr></table></figure>
<p>唤醒阻塞在某条件变量上的线程：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pthread_cond_signal(<span class="keyword">pthread_cond_t</span> *cv); <span class="comment">//唤醒至少一个阻塞在该cond上的线程</span></span><br><span class="line">pthread_cond_broadcast(<span class="keyword">pthread_cond_t</span> *cv); <span class="comment">// 唤醒所有阻塞在该cond上的线程</span></span><br><span class="line"><span class="comment">//前者单播，后者广播</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Java：<br>TODO</p>
</li>
</ul>
</li>
<li>线程池<br>事先将线程放到一个容器中，当使用线程的时候，不用再去new出一个线程，直接从线程池取出来<br>优点：  <ul>
<li>降低资源消耗：即重复利用线程池中的线程可以节省线程创建和销毁带来的消耗  </li>
<li>提高性能：当任务需求时，可以不用创建线程直接执行，主要是直接从线程池中取出线程去执行  </li>
<li>提高线程的可管理性：线程是稀缺资源，而且也是任务中不可少的资源，如果频繁的且无限制的创建会消耗系统资源，降低系统稳定性导致系统崩溃，内存溢出等等问题</li>
</ul>
</li>
<li>线程安全<br>多线程访问同一代码，不会产生不确定的结果。编写线程安全的代码是低依靠<strong>线程同步</strong>。<br>线程安全的类：<strong>StringBuffer</strong>， <strong>HashTable</strong>， <strong>Vector</strong><br>线程不安全的类：<strong>StringBuilder</strong>（速度更快），<strong>HashMap</strong></li>
<li>控制线程执行顺序：<ul>
<li>信号量：signal，就上述关于pthread相关的函数</li>
<li>sem_post:<br>sem_t为一个变量，post是给她+1，wait如果它是0则阻塞，非0则-1<br>例：初始化为0，线程1 wait直接阻塞，线程2 执行结束post给它加一，线程1则开始执行</li>
</ul>
</li>
</ul>
<h2 id="进程（process）与线程（thread）"><a href="#进程（process）与线程（thread）" class="headerlink" title="进程（process）与线程（thread）"></a>进程（process）与线程（thread）</h2><p>线程是进程的一个执行流，一个进程可以由很多个线程组成  </p>
<table>
<thead>
<tr>
<th>进程</th>
<th>线程</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>资源分配</strong>的最小单位</td>
<td><strong>程序执行</strong>的最小单位</td>
</tr>
<tr>
<td>数据分开，需要IPC。共享复杂，同步简单</td>
<td>共享简单，同步复杂</td>
</tr>
<tr>
<td>占用内存多，切换复杂，CPU利用低</td>
<td>占用内存少，切换简单，CPU利用率高</td>
</tr>
<tr>
<td>编程简单调试简单</td>
<td>难</td>
</tr>
<tr>
<td>进程之间不会相互影响</td>
<td>一个线程挂掉将导致整个进程挂掉</td>
</tr>
<tr>
<td>分布式扩展到多台电脑比较简单</td>
<td>适用于多核分布</td>
</tr>
<tr>
<td>创建/销毁代价高</td>
<td>低</td>
</tr>
<tr>
<td>有独立的地址空间</td>
<td>多个线程共享同一个进程的地址空间</td>
</tr>
</tbody>
</table>
<h2 id="Linux系统"><a href="#Linux系统" class="headerlink" title="Linux系统"></a>Linux系统</h2><ul>
<li>ELF文件：是一种文件格式。可执行文件、目标文件、共享库和核心转储。由四部分组成<ul>
<li>ELF header</li>
<li>Program header table</li>
<li>Section</li>
<li>Section header table<br><img src="https://zztttt.github.io/picture/operating-system/ELF.png" alt="ELF"><br>TODO: 其大小与程序中全局变量是否初始化有什么关系（注意未初始化的数据放在bss段）bss在一开始全部清零</li>
</ul>
</li>
<li>系统调用和库函数  </li>
</ul>
<table>
<thead>
<tr>
<th>系统调用</th>
<th>库函数</th>
</tr>
</thead>
<tbody>
<tr>
<td>操作系统为用户提供的一系列操作的接口</td>
<td>对系统调用的一层封装</td>
</tr>
<tr>
<td>线程安全</td>
<td>非线程安全</td>
</tr>
</tbody>
</table>
<ul>
<li>临界区：<br>在任意时刻只允许一个线程对共享资源进行访问。<br>如果有多个线程试图同时访问临界区，那么在有一个线程进入后其他所有试图访问此临界区的线程将被挂起，并一直持续到进入临界区的线程离开。<br>临界区在被释放后，其他线程可以继续抢占，并以此达到用原子方式操作共享资源的目的。</li>
<li>内存管理机制：<br>虚拟地址、物理地址、逻辑地址。虚拟地址和物理地址之间采用<strong>多级页表</strong>映射</li>
<li>页面置换算法：<ul>
<li>FIFO：只是在按<strong>线性顺序</strong>访问地址空间时才是理想的，否则效率不高</li>
<li>LRU：<ul>
<li>优点：命中率,当存在热点数据时,LRU的效率很好；实现相对简单</li>
<li>缺点：偶发性的,周期性的批量操作会导致LRU命中率急剧下降,缓存污染情况比较严重；命中时需要遍历链表,找到命中的数据块索引,然后需要将数据移到头部</li>
</ul>
</li>
<li>LFU</li>
<li>CLOCK：LRU算法的近似实现</li>
<li>OPT：最佳置换算法，实际上不可能实现。每个页面都可以用在该页面首次被访问前所要执行的指令数进行标记。最佳页面置换算法只是简单地规定：标记最大的页应该被置换。</li>
</ul>
</li>
<li>同步机制：<ul>
<li>每个cpu一个变量</li>
<li>原子操作：PV</li>
<li>自旋锁：锁住一块临界区，进入时需要获取自旋锁。<br>读写自旋锁：允许多个进程同时对同一数据结构进行<strong>读</strong>，但不允许多个进程同时<strong>修改</strong>同一数据结构，因此在实现上必须分为读锁和写锁。  </li>
<li>顺序锁：写锁不会因为读锁而锁住</li>
<li>信号量：存在一个进程等待队列，未获取锁的进程将挂到该队列中，然后主动调用schedule()切换进程，让出cpu</li>
<li>禁止本地中断</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>读锁</th>
<th>写锁</th>
</tr>
</thead>
<tbody>
<tr>
<td>实现<strong>多个进程</strong>能同时读同一数据结构，但是读的过程中不允许写</td>
<td>实现仅能有<strong>一个</strong>进程获取写锁进入临界区，获取写锁时同时保证没有进程已经获取读锁</td>
</tr>
</tbody>
</table>
<ul>
<li>链接：<br>分为动态链接和静态链接。<br>动态链接生成可执行文件时不将所需函数链接到一个文件，而是要用的时候从系统ddl里面找。静态链接就是把所有文件都放入exe里面</li>
<li>文件系统：ext2 ext3 ext4。。。</li>
</ul>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><ul>
<li>可重入锁（递归锁）：<ul>
<li>在同一个线程在外层方法获取锁的时候，再进入该线程的内层方法会自动获取锁（前提锁对象的是同一个对象或者class），不会因为之前已经获取过还没释放而阻塞</li>
<li>可重入锁可以让当前进程再次获取锁，不可重入锁会直接获取失败导致阻塞。可以<strong>一定程度</strong>避免死锁。</li>
<li>加锁：先尝试获取并更新status的值，如果为0表示没有其他的线程占用，将其置为1；若不为0，则判断是否是当前线程在占有锁，如果是，status++，并再次获取锁，不是则导致获取锁失败，阻塞</li>
<li>解锁：先获取status值，如果是当前线程战有锁，如果status == 1，则置为0并释放，否则status–，不释放。</li>
</ul>
</li>
<li>乐观锁/悲观锁：</li>
</ul>
<table>
<thead>
<tr>
<th>乐观锁</th>
<th>悲观锁</th>
</tr>
</thead>
<tbody>
<tr>
<td>每次拿数据的时候认为别人不会改，所以不会锁</td>
<td>每次拿数据都会锁</td>
</tr>
<tr>
<td>适用于<strong>多读</strong>（在拿数据时会判断是否有人改数据）</td>
<td></td>
</tr>
<tr>
<td>java.util.concurrent.atomic</td>
<td>synchronized、ReentrantLock</td>
</tr>
</tbody>
</table>
<ul>
<li>生产者消费者模型：<br>生产者：生产消费者需要的资料。消费者：把资料做成产品<ul>
<li>生产者生产数据到缓冲区中，消费者从缓冲区中取数据</li>
<li>如果缓冲区已经满了，则生产者线程阻塞</li>
<li>如果缓冲区为空，那么消费者线程阻塞</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2020/06/29/Cpp/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2020/06/29/Cpp/" class="post-title-link" itemprop="url">C/C++</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-29 19:31:18" itemprop="dateCreated datePublished" datetime="2020-06-29T19:31:18+08:00">2020-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/zztttt/" itemprop="url" rel="index"><span itemprop="name">zztttt</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一个程序在内存中分为五个段："><a href="#一个程序在内存中分为五个段：" class="headerlink" title="一个程序在内存中分为五个段："></a>一个程序在内存中分为五个段：</h2><ul>
<li>text: 保存源代码</li>
<li>data： 初始化的全局变量和静态变量</li>
<li>bss： 未初始化的全局变量和静态变量 或 初始化为0的</li>
<li>stack： 程序运行时栈，保存局部变量、可能存在的argument以及return的地址</li>
<li>heap: 用来保存手动分配出来的内存，由用户管理。内存块由一条链表来维护</li>
</ul>
<h2 id="volatile的作用"><a href="#volatile的作用" class="headerlink" title="volatile的作用"></a>volatile的作用</h2><ul>
<li>不可优化性：当一个变量即使是不用，也不让编译器去优化它。</li>
<li>下一条语句不会直接使用上一条语句对应的volatile变量的寄存器内容，而是重新从内存中读取。即不让编译器去随意把它给优化掉。</li>
</ul>
<h2 id="全局变量和局部变量的区别："><a href="#全局变量和局部变量的区别：" class="headerlink" title="全局变量和局部变量的区别："></a>全局变量和局部变量的区别：</h2><ul>
<li>作用范围不同</li>
<li>在存储器中存储位置不同，全局是在数据段中，局部变量一般在堆/栈段</li>
<li>操作系统通过内存分配的位置来知道全局变量在全局数据段，在程序运行的时候加载</li>
<li>编译器通过词法分析来知道它是全局变量还是局部</li>
</ul>
<h2 id="static关键字"><a href="#static关键字" class="headerlink" title="static关键字:"></a>static关键字:</h2><ul>
<li>static成员函数：只能调用static成员变量</li>
<li>static成员：所有instance共享，不能在类的内部初始号，在类的实现文件中初始化</li>
</ul>
<h2 id="const关键字："><a href="#const关键字：" class="headerlink" title="const关键字："></a>const关键字：</h2><ul>
<li>const成员函数：<strong>不改变</strong>数据成员的成员函数都要在后面加 const，而对于改变数据成员的成员函数不能加 const。</li>
<li>const成员：不能在类的内部初始化，只能通过构造函数初始化</li>
</ul>
<h2 id="多态性："><a href="#多态性：" class="headerlink" title="多态性："></a>多态性：</h2><ul>
<li>静多态：template和函数重载<br>template在编译期决定，模板的实例化就在编译期对其进行替换。<br>重载是参数表，C++编译时会将函数的参数类型加在函数symbol的后面，因此参数不一样的函数也不一样</li>
<li>动多态<br>虚函数，是动态绑定，运行时决定</li>
</ul>
<h2 id="虚函数："><a href="#虚函数：" class="headerlink" title="虚函数："></a>虚函数：</h2><ul>
<li><p>纯虚函数：virtual xxx = 0；在派生类中重写成员函数的实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">func1</span><span class="params">()</span> </span>= <span class="number">0</span>; <span class="comment">// pure virtual function</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">func2</span><span class="params">()</span></span>; <span class="comment">// normal virtual function</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span> <span class="keyword">public</span> A &#123;...&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span> <span class="keyword">public</span> A &#123;...&#125;;</span><br><span class="line"></span><br><span class="line">A* a = <span class="keyword">new</span> B(); a-&gt;func1(); <span class="comment">// B::func1</span></span><br><span class="line">A* b = <span class="keyword">new</span> C(); b-&gt;func1(); <span class="comment">// C::func1</span></span><br><span class="line">a-&gt;A::func1(); <span class="comment">// A::func1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>普通虚函数: 在基类中定义一个缺省实现，表示继承的是基类成员函数接口和缺省实现，由派生类选择是否重写该函数。<br>但是这种方式是<strong>很危险</strong>的！因为可能<strong>忘记重写</strong>！<br>解决方案：最好是基类中实现缺省行为，但<strong>只有在派生类要求时</strong>才提供该缺省行为。<br>使用C++11的关键字override,可以显式的在派生类中声明，哪些成员函数需要被重写，如果没被重写，则编译器会报错。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">func1</span><span class="params">()</span> override</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>原理：<br>virtual table里存的成员函数地址，在继承重写的时候，会替换其相应位置重写后的函数地址，但是因为是同样的offset，所以在运行时会找到正确的函数地址。<br><img src="https://zztttt.github.io/picture/C++/virtualFunc.png" alt="pic1"></p>
</li>
<li>使用：<br>构造函数不能为虚函数，而析构函数可以且常常是虚函数。  C++对象在三个地方构建：（1）函数堆栈 stack；（2）自由存储区，或称之为heap；（3）静态存储区。<br>无论在那里构建，其过程都是两步：首先，分配一块内存；其次，调用构造函数。好，问题来了，如果构造函数是虚函数，那么就需要通过vtable 来调用，但此时面对一块 raw memeory，到哪里去找 vtable 呢？毕竟，vtable 是在构造函数中才初始化的啊，而不是在其之前。因此构造函数<strong>不能为</strong>虚函数。<br>析构函数<strong>可以是</strong>虚函数，且常常如此。因为此时 vtable 已经初始化了；况且我们通常通过基类的指针来销毁对象，如果析构函数不为虚的话，就不能正确识别对象类型，从而不能正确销毁对象。<br>每个析构函数（不加 virtual）只负责清除自己的成员。但可能有基类指针，指向的确是派生类成员的情况。（这是很正常的）。那么当析构一个指向派生类成员的基类指针时，程序就不知道怎么办了。所以要保证运行适当的析构函数，基类中的析构函数<strong>必须为</strong>虚析构。</li>
</ul>
<h2 id="继承："><a href="#继承：" class="headerlink" title="继承："></a>继承：</h2><ul>
<li>虚继承：<br><img src="https://zztttt.github.io/picture/C++/虚继承.png" alt="虚继承"><br>在多重继承中，如果发生了如：类B继承类A，类C继承类A，类D同时继承了类B和类C。最终在类D中就有了两份类A的成员，这在程序中是不能容忍的。当然解决这个问题的方法就是利用<strong>虚继承</strong>。<br>在派生时将关键字virtual加在相应相应继承方式前，就可防止在D类中同时出现两份A类成员。只会将虚基类的构造函数调用一次，忽略虚基类的其他派生类（class B，class C）对虚继承的构造函数的调用，从而保证了虚基类的数据成员不会被多次初始化</li>
<li>内存分布：<br><img src="https://zztttt.github.io/picture/C++/内存分布.png" alt="内存分布">  <h2 id="指针-amp-amp-引用："><a href="#指针-amp-amp-引用：" class="headerlink" title="指针&amp;&amp;引用："></a>指针&amp;&amp;引用：</h2></li>
<li>指针是一个变量，只不过这个变量存储的是一个地址，指向内存的一个存储单元，即指针是一个实体；而引用跟原来的变量实质上是同一个东西，只不过是原变量的一个别名</li>
<li>两者都是地址的概念；指针指向一块内存，它的内容是所指内存的地址；引用是某块内存的别名。</li>
<li>可以有const指针，但是没有const引用；</li>
<li>指针可以有多级，但是引用只能是一级（int **p；合法 而 int &amp;&amp;a是不合法的）</li>
<li>指针的值可以为空，但是引用的值不能为NULL，并且引用在定义的时候必须初始化；</li>
<li>指针的值在初始化后可以改变，即指向其它的存储单元，而引用在进行初始化后就不会再改变了，从一而终。</li>
<li>”sizeof引用”得到的是所指向的变量(对象)的大小，而”sizeof指针”得到的是指针本身的大小；</li>
<li>指针和引用的自增(++)运算意义不一样</li>
</ul>
<h2 id="函数返回局部变量的引用"><a href="#函数返回局部变量的引用" class="headerlink" title="函数返回局部变量的引用"></a>函数返回局部变量的引用</h2><ul>
<li>当函数返回引用类型时，没有复制返回值，相反，返回的是对象本身。</li>
<li><strong>千万不要</strong>返回局部对象的引用！千万不要返回指向局部对象的指针！当函数执行完毕时，将释放分配给局部对象的存储空间。此时对局部对象的引用会指向不确定的内存！返回指向局部对象的指针也是一样的，当函数结束时，局部对象被释放，返回的指针就变成了不再存在对象的悬垂指针。</li>
<li>返回引用时，要求在函数的参数中，包含有以引用方式或指针方式存在的，需要被返回的参数。</li>
</ul>
<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><ul>
<li>不再会被使用的对象的内存不能被回收，就是内存泄露</li>
<li>在C++中，所有被分配了内存的对象，不再使用后，都必须程序员手动释放他们。所以，每个类，都会含有一个析构函数，作用就是完成清理工作，如果我们忘记了某些对象的释放，就会造成内存泄露。</li>
</ul>
<h2 id="构造-析构函数的执行顺序"><a href="#构造-析构函数的执行顺序" class="headerlink" title="构造/析构函数的执行顺序"></a>构造/析构函数的执行顺序</h2><p>构造的时候先构造基类后子类，析构的时候相反先析构子类后析构基类  </p>
<h2 id="内联成员函数（编译展开），静态成员函数（编译确定，不能重写）"><a href="#内联成员函数（编译展开），静态成员函数（编译确定，不能重写）" class="headerlink" title="内联成员函数（编译展开），静态成员函数（编译确定，不能重写）"></a>内联成员函数（编译展开），静态成员函数（编译确定，不能重写）</h2><h2 id="重写（override）和重载（overload）："><a href="#重写（override）和重载（overload）：" class="headerlink" title="重写（override）和重载（overload）："></a>重写（override）和重载（overload）：</h2><ul>
<li>重写是覆盖，是派生类重写基类的相应方法。要求函数名、参数相同</li>
<li>重载是同样的函数名，但是不同的参数，有参数表的存在。比如类的多个构造函数</li>
</ul>
<h2 id="重载的过程"><a href="#重载的过程" class="headerlink" title="重载的过程"></a>重载的过程</h2><ul>
<li>C++为了支持函数重载，是编译器的函数符号改名机制，符号名是在对应的函数名上改编的。</li>
<li>简单来说就是函数的symbol是根据函数名、函数参数表（类型、数量）相关的</li>
<li>例如 func(…)参数为一个int，就加一个i，为float就加一个f，char就加一个c，int&amp;则加Ri，依此类推</li>
<li>所以可以容易理解，用C++去找由C编译的函数，则会找不到定义。所以应该加一个extern C</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2020/06/19/hexo-theme-Next-background/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2020/06/19/hexo-theme-Next-background/" class="post-title-link" itemprop="url">hexo theme: Next background</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-19 18:26:41" itemprop="dateCreated datePublished" datetime="2020-06-19T18:26:41+08:00">2020-06-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/others/" itemprop="url" rel="index"><span itemprop="name">others</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>hexo给主题next设置背景图片。<br>首先了解hexo部署在GitHub page上的原理。它将 <strong>$HEXO_ROOTDIR/source</strong> 目录下的内容编译成静态html页面，因此可以将图片放在新建的picture目录下。<br>关于theme的背景，则是在 <strong>$HEXO_ROOTDIR/$THEME/source</strong> 目录下，编辑 <strong>/css/_custom/custom.styl</strong> 文件，插入以下代码。<br>然后将所选图片放入images/目录下即可<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"> 	background:url(/images/bz.jpg);// 设定背景图片,images同处于theme/source文件夹下</span><br><span class="line"> 	background-repeat: no-repeat;// 设定背景图片非重复填充</span><br><span class="line">    background-attachment:fixed;// 设置背景图片不随页面滚动</span><br><span class="line">    background-position:50% 50%;// 设置背景图片位置</span><br><span class="line">	background-size: cover// 设置保持图像的纵横比并将图像缩放成将完全覆盖背景定位区域的最小大小</span><br><span class="line">&#125;</span><br><span class="line">// 页面头样式属性</span><br><span class="line"><span class="selector-class">.header-inner</span> &#123;</span><br><span class="line">  // 也可以同时定义背景色</span><br><span class="line">  // background: #ddd </span><br><span class="line">  // 透明度</span><br><span class="line">  // opacity: 0.8;</span><br><span class="line">&#125;</span><br><span class="line">// sidebar侧边工具栏样式属性</span><br><span class="line"><span class="selector-class">.sidebar</span>&#123;</span><br><span class="line">    // 动画过渡时间</span><br><span class="line">	<span class="selector-tag">transition-duration</span>: 0<span class="selector-class">.4s</span>;</span><br><span class="line">    // 透明度</span><br><span class="line">	<span class="selector-tag">opacity</span>: 0<span class="selector-class">.8</span></span><br><span class="line">&#125;</span><br><span class="line">// 标题样式</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-title-link</span> &#123;</span><br><span class="line">	// 设置字体颜色</span><br><span class="line">	<span class="selector-tag">color</span>: <span class="selector-id">#222</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 文章版块样式</span><br><span class="line"><span class="selector-class">.post-block</span> &#123;</span><br><span class="line">    //background: var(--content-bg-color);</span><br><span class="line">	<span class="selector-tag">background</span>: <span class="selector-id">#fff</span></span><br><span class="line">    <span class="selector-tag">border-radius</span>: <span class="selector-tag">initial</span>;</span><br><span class="line">    <span class="selector-tag">box-shadow</span>: 0 2<span class="selector-tag">px</span> 2<span class="selector-tag">px</span> 0 <span class="selector-tag">rgba</span>(0,0,0,0<span class="selector-class">.12</span>), 0 3<span class="selector-tag">px</span> 1<span class="selector-tag">px</span> <span class="selector-tag">-2px</span> <span class="selector-tag">rgba</span>(0,0,0,0<span class="selector-class">.06</span>), 0 1<span class="selector-tag">px</span> 5<span class="selector-tag">px</span> 0 <span class="selector-tag">rgba</span>(0,0,0,0<span class="selector-class">.12</span>);</span><br><span class="line">    <span class="selector-tag">padding</span>: 40<span class="selector-tag">px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后重新部署一遍<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.csdn.net/TomAndersen/article/details/104872852" target="_blank" rel="noopener">Next主题设置背景图片</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2020/06/17/hexo-theme-Next-configuration/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2020/06/17/hexo-theme-Next-configuration/" class="post-title-link" itemprop="url">hexo theme: Next configuration</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-17 18:27:33" itemprop="dateCreated datePublished" datetime="2020-06-17T18:27:33+08:00">2020-06-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/others/" itemprop="url" rel="index"><span itemprop="name">others</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>项目地址：<a href="https://github.com/theme-next">theme-next</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HEXO_ROOTDIR</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/theme-next theme/next</span><br><span class="line">vim _config.yml</span><br><span class="line"><span class="built_in">set</span>: theme: hexo-theme-next</span><br><span class="line">     language: zh-Hans</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> themes/hexo-theme-next</span><br><span class="line">vim _config.yml</span><br><span class="line"><span class="built_in">set</span>: scheme: Gemini</span><br></pre></td></tr></table></figure></p>
<p>打开分类和标签页面<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HEXO_ROOTDIR</span></span><br><span class="line">hexo new page categories &amp;&amp; hexo new page tags</span><br></pre></td></tr></table></figure></p>
<p>会提示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO  Created: ~/<span class="built_in">source</span>/categories/index.md</span><br><span class="line">INFO  Created: ~/<span class="built_in">source</span>/tags/index.md</span><br></pre></td></tr></table></figure></p>
<p>在index.md中修改成<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章分类</span><br><span class="line">date: xxx</span><br><span class="line"><span class="built_in">type</span>: <span class="string">"categories"</span></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>最后在文章中添加<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">title: xxx</span><br><span class="line">data: xxx</span><br><span class="line">categories: Categories</span><br><span class="line">tags: </span><br><span class="line">- Tags1</span><br><span class="line">- Tags2</span><br></pre></td></tr></table></figure></p>
<p>最后在远端更新<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HEXO_ROOTDIR</span></span><br><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h2><p><a href="https://www.himmy.cn/2019/07/06/hexo-next%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%94%B9%E8%AF%AD%E8%A8%80/" target="_blank" rel="noopener">Next主题更改语言</a><br><a href="https://www.jianshu.com/p/e17711e44e00" target="_blank" rel="noopener">Next主题添加标签</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2019/05/19/Virtual-Table/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2019/05/19/Virtual-Table/" class="post-title-link" itemprop="url">C++：Virtual Table</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-19 18:54:20" itemprop="dateCreated datePublished" datetime="2019-05-19T18:54:20+08:00">2019-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/zztttt/" itemprop="url" rel="index"><span itemprop="name">zztttt</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/programming/" itemprop="url" rel="index"><span itemprop="name">programming</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文旨在分析C++中虚函数的实现细节，着重于class类内部的内存空间分布<br>对以下类，其内存空间分布为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> b;</span><br><span class="line">&#125;</span><br><span class="line">A t;</span><br><span class="line"><span class="keyword">sizeof</span>(t) = <span class="number">16</span></span><br><span class="line">&amp;t = &amp;t.a = base;</span><br><span class="line">&amp;t.b = base + <span class="number">0x8</span>;</span><br><span class="line"></span><br><span class="line">high&lt;---|---------| -&gt;base + <span class="number">0x10</span></span><br><span class="line">        |   ll    | </span><br><span class="line">        |---------| -&gt;base + <span class="number">0x8</span></span><br><span class="line">        |    |<span class="keyword">int</span> | </span><br><span class="line">low&lt;----|---------| -&gt;base</span><br></pre></td></tr></table></figure>
<p>若它有一个虚函数,则其内存空间分布为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> b;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">vfun</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">sizeof</span>(A) = <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">high&lt;---|---------| -&gt;base + <span class="number">0x18</span></span><br><span class="line">        |   ll    | </span><br><span class="line">        |---------| -&gt;base + <span class="number">0x10</span></span><br><span class="line">        |    |<span class="keyword">int</span> |                                  </span><br><span class="line">        |---------| -&gt;base + <span class="number">0x8</span>                   vtable</span><br><span class="line">        |  <span class="keyword">void</span>** | -&gt;vfptr:<span class="number">0x7FF684A63308</span> ----&gt;|----------|</span><br><span class="line">low&lt;----|---------| -&gt;base                      |   <span class="keyword">void</span>*  |-&gt;<span class="number">0x7FF684A61070</span> -&gt; vfun1</span><br><span class="line">                                                |----------|</span><br><span class="line">                                                |   <span class="keyword">void</span>*  |-&gt;<span class="number">0x7FF684A610B0</span> -&gt; vfun2</span><br><span class="line">                                                |----------|</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2019/04/26/SmartPointer/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2019/04/26/SmartPointer/" class="post-title-link" itemprop="url">C++：SmartPointer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-26 21:57:32" itemprop="dateCreated datePublished" datetime="2019-04-26T21:57:32+08:00">2019-04-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/zztttt/" itemprop="url" rel="index"><span itemprop="name">zztttt</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/programming/" itemprop="url" rel="index"><span itemprop="name">programming</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="为何使用智能指针？"><a href="#为何使用智能指针？" class="headerlink" title="为何使用智能指针？"></a>为何使用智能指针？</h3><ol>
<li>因为能帮我们管理内存，避免内存泄漏</li>
<li>能帮我们处理空悬指针（俗称野指针，即delete掉指针后，原来的指针指向了垃圾区域）的问题</li>
</ol>
<h3 id="智能指针的类型"><a href="#智能指针的类型" class="headerlink" title="智能指针的类型"></a>智能指针的类型</h3><ul>
<li>shared_ptr: 多个智能指针指向同一块区域，该对象会在最后一个引用被销毁时释放。</li>
<li>unique_ptr: 每个对象只能有一个智能指针指向它，避免资源泄漏。</li>
</ul>
<h3 id="shared-ptr的实现"><a href="#shared-ptr的实现" class="headerlink" title="shared_ptr的实现"></a>shared_ptr的实现</h3><p>详见 <a href="https://github.com/zztttt/SmartPtr">SmartPtr</a><br>类的内部细节如下：<br>内部ptr保留的是真实的指针，由该类来自动维护它<br>count是对真实指针引用的计数  </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">sharedPtr</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	T* ptr;</span><br><span class="line">	<span class="keyword">int</span>* count;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	sharedPtr();</span><br><span class="line">	sharedPtr(T*);</span><br><span class="line">	~sharedPtr();</span><br><span class="line">	sharedPtr(<span class="keyword">const</span> sharedPtr&lt;T&gt;&amp; t);</span><br><span class="line">	sharedPtr&lt;T&gt;&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> sharedPtr&lt;T&gt;&amp; right);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>对于 p1(p2)这种复制构造，事实上是将参数的count加一，即又增加了对资源的引用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">sharedPtr</span>&lt;T&gt;:</span>:sharedPtr(<span class="keyword">const</span> sharedPtr&lt;T&gt;&amp; t)</span><br><span class="line">&#123;</span><br><span class="line">	ptr = t.ptr;</span><br><span class="line">	count = t.count;</span><br><span class="line">	(*count)++;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"copy from "</span> &lt;&lt; &amp;t &lt;&lt; <span class="string">"to"</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于p2 = p2这种复制构造，事实上是将右侧的的count减一，将左侧的count减一，减后进行判断是否要进行资源的释放来自行维护。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">sharedPtr</span>&lt;T&gt;&amp; <span class="title">sharedPtr</span>&lt;T&gt;:</span>:<span class="keyword">operator</span>=(<span class="keyword">const</span> sharedPtr&lt;T&gt;&amp; right)</span><br><span class="line">&#123;</span><br><span class="line">	(*right.count)++;</span><br><span class="line">	(*count)--;</span><br><span class="line">	<span class="keyword">if</span> (*count == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">delete</span> ptr;</span><br><span class="line">		<span class="keyword">delete</span> count;</span><br><span class="line">		ptr = <span class="literal">nullptr</span>;</span><br><span class="line">		count = <span class="literal">nullptr</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"delete left element:"</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ptr = right.ptr;</span><br><span class="line">	count = right.count;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"copy right to left"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2019/04/25/configuration/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zztttt.github.io/images/avatar.gif">
      <meta itemprop="name" content="ZhangZhengtong">
      <meta itemprop="description" content="SE@SJTU">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zztttt">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zztttt.github.io/2019/04/25/configuration/" class="post-title-link" itemprop="url">hexo主题的切换</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-25 19:37:46" itemprop="dateCreated datePublished" datetime="2019-04-25T19:37:46+08:00">2019-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-13 18:01:38" itemprop="dateModified" datetime="2022-08-13T18:01:38+08:00">2022-08-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/zztttt.github.io/categories/others/" itemprop="url" rel="index"><span itemprop="name">others</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>网上找到一个比较清爽的主题，也就是我现在用的这一个<a href="https://github.com/tufu9441/maupassant-hexo">maupassant</a><br>步骤如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/tufu9441/maupassant-hexo themes/maupassant</span><br><span class="line">npm install hexo-renderer-pug --save</span><br><span class="line">npm install hexo-renderer-sass --save</span><br><span class="line"><span class="built_in">cd</span> themes/maupassant</span><br><span class="line">修改 theme:landscape -&gt; theme:maupassant</span><br></pre></td></tr></table></figure>
<p>这时在在本地能正确渲染出新的主题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo server --debug</span><br><span class="line">curl localhost:4000</span><br></pre></td></tr></table></figure>
<p>部署到remote</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure>
<p>然而直接访问zztttt.github.io发现只有内容，css渲染失败。很容易想到F12打开浏览器去寻找css代码的地址是否正确<br>请求网址：<del><a href="http://zztttt.github.io/css/style.css" target="_blank" rel="noopener">http://zztttt.github.io/css/style.css</a></del><br>应当为：<a href="http://zztttt/github.io/zztttt.ghub.io/css/style.css" target="_blank" rel="noopener">http://zztttt/github.io/zztttt.ghub.io/css/style.css</a><br>因为zztttt.github.io是你的repo地址，相当于把你的blog部署到你的URL的Repo目录下<br>直接修改_config.yml配置即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># URL</span><br><span class="line">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</span><br><span class="line">url: http://github.com #???</span><br><span class="line">root: /zztttt.github.io</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br><span class="line">permalink_defaults:</span><br></pre></td></tr></table></figure>
<p>然后再按照上述步骤部署一遍即可。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.haomwei.com/technology/maupassant-hexo.html" target="_blank" rel="noopener">大道至简——Hexo简洁主题推荐</a><br><a href="https://hexo.io/docs/configuration" target="_blank" rel="noopener">hexo document</a><br><a href="https://blog.csdn.net/starryasky/article/details/83378011" target="_blank" rel="noopener">hexo+Github搭建博客，能访问但无法加载css文件</a><br><a href="https://github.com/tufu9441/maupassant-hexo">maupassant-hexo</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/zztttt.github.io/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/zztttt.github.io/">1</a><a class="page-number" href="/zztttt.github.io/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/zztttt.github.io/page/4/">4</a><a class="extend next" rel="next" href="/zztttt.github.io/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ZhangZhengtong</p>
  <div class="site-description" itemprop="description">SE@SJTU</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/zztttt.github.io/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/zztttt.github.io/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/zztttt.github.io/tags/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhangZhengtong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/zztttt.github.io/lib/anime.min.js"></script>
  <script src="/zztttt.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/zztttt.github.io/lib/velocity/velocity.ui.min.js"></script>
<script src="/zztttt.github.io/js/utils.js"></script><script src="/zztttt.github.io/js/motion.js"></script>
<script src="/zztttt.github.io/js/schemes/pisces.js"></script>
<script src="/zztttt.github.io/js/next-boot.js"></script>



  















  

  

</body>
</html>
